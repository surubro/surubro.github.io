<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Money Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f5f5f5; }
    .container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    h2 { text-align:center; }
    .input-box { margin:10px 0; }
    input { width:100%; padding:10px; font-size:16px; margin-top:5px; box-sizing:border-box; }
    button { padding:10px 15px; margin:5px 0; border:none; border-radius:6px; cursor:pointer; font-size:16px; }
    .btn-primary { background:#4CAF50; color:white; }
    .btn-secondary { background:#2196F3; color:white; }
    .btn-danger { background:#f44336; color:white; }
    .card { background:#fafafa; padding:10px; margin:8px 0; border-radius:6px; display:flex; justify-content:space-between; align-items:center; }
    .actions button { margin-left:5px; font-size:14px; padding:5px 8px; }
    #totalBox { font-size:18px; font-weight:bold; margin-top:15px; text-align:right; }
    @media (max-width:600px) {
      .card { flex-direction:column; align-items:flex-start; }
      .actions { margin-top:5px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ’° Money Tracker</h2>

    <!-- Login Form -->
    <div id="loginBox">
      <div class="input-box">
        <label>Email</label>
        <input type="email" id="email">
      </div>
      <div class="input-box">
        <label>Password</label>
        <input type="password" id="password">
      </div>
      <button class="btn-primary" id="loginBtn">Login</button>
    </div>

    <!-- Tracker UI -->
    <div id="trackerBox" style="display:none;">
      <button class="btn-secondary" id="logoutBtn">Logout</button>

      <div class="input-box">
        <label>Description</label>
        <input type="text" id="descInput" placeholder="Enter description">
      </div>
      <div class="input-box">
        <label>Amount</label>
        <input type="number" id="amountInput" placeholder="Enter amount">
      </div>
      <button class="btn-primary" id="addBtn">Add</button>

      <h3>Records</h3>
      <div id="list"></div>

      <div id="totalBox">Total: â‚¹0</div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ðŸ”¥ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
      authDomain: "striped-acrobat-342207.firebaseapp.com",
      databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
      projectId: "striped-acrobat-342207",
      storageBucket: "striped-acrobat-342207.appspot.com",
      messagingSenderId: "367114842706",
      appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const moneyRef = ref(db, "money");

    // ðŸ”‘ Auth State
    onAuthStateChanged(auth, (user) => {
      if (user && user.emailVerified) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("trackerBox").style.display = "block";
        loadData();
      } else {
        document.getElementById("loginBox").style.display = "block";
        document.getElementById("trackerBox").style.display = "none";
      }
    });

    // Login
    document.getElementById("loginBtn").addEventListener("click", () => {
      let email = document.getElementById("email").value;
      let password = document.getElementById("password").value;
      signInWithEmailAndPassword(auth, email, password)
        .then((userCred) => {
          if (!userCred.user.emailVerified) {
            alert("Please verify your email before login.");
            signOut(auth);
          }
        })
        .catch((err) => alert(err.message));
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => signOut(auth));

    // Add Record
    document.getElementById("addBtn").addEventListener("click", () => {
      let desc = document.getElementById("descInput").value.trim();
      let amount = parseFloat(document.getElementById("amountInput").value);
      if (!desc || isNaN(amount)) {
        alert("Enter valid description and amount");
        return;
      }
      push(moneyRef, { desc, amount });
      document.getElementById("descInput").value = "";
      document.getElementById("amountInput").value = "";
    });

    // Load + Listen Records
    function loadData() {
      onValue(moneyRef, (snapshot) => {
        let listDiv = document.getElementById("list");
        listDiv.innerHTML = "";
        let total = 0;

        if (snapshot.exists()) {
          snapshot.forEach((childSnap) => {
            let id = childSnap.key;
            let item = childSnap.val();
            total += Number(item.amount);

            let div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `
              <div><strong>${item.desc}</strong> - â‚¹${item.amount}</div>
              <div class="actions">
                <button class="btn-secondary editBtn" data-id="${id}" data-desc="${item.desc}" data-amount="${item.amount}">Edit</button>
                <button class="btn-danger deleteBtn" data-id="${id}">Delete</button>
              </div>
            `;
            listDiv.prepend(div);
          });
        }
        document.getElementById("totalBox").innerText = "Total: â‚¹" + total;

        // Attach listeners
        document.querySelectorAll(".editBtn").forEach(btn => {
          btn.onclick = () => {
            let id = btn.dataset.id;
            let oldDesc = btn.dataset.desc;
            let oldAmount = btn.dataset.amount;
            let newDesc = prompt("Edit description:", oldDesc);
            let newAmount = parseFloat(prompt("Edit amount:", oldAmount));
            if (newDesc && !isNaN(newAmount)) {
              update(ref(db, "money/" + id), { desc: newDesc, amount: newAmount });
            }
          };
        });

        document.querySelectorAll(".deleteBtn").forEach(btn => {
          btn.onclick = () => {
            let id = btn.dataset.id;
            if (confirm("Delete this record?")) remove(ref(db, "money/" + id));
          };
        });
      });
    }
  </script>
</body>
</html>
