<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Spending Tracker</title>
<style>
body{font-family:Arial;background:#f3f4f6;margin:0}
.container{max-width:650px;margin:auto;padding:15px}
.card{background:#fff;padding:15px;margin:10px 0;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{background:#4f46e5;color:#fff;border:none}
button.danger{background:#dc2626}
.green{color:#16a34a;font-weight:bold}
.red{color:#dc2626;font-weight:bold}
h2{text-align:center}
.small{font-size:12px;color:#6b7280}
.collapsible h3{margin:0;cursor:pointer;display:flex;justify-content:space-between}
.content{display:none;margin-top:10px}
</style>
</head>
<body>
<div class="container">

<h2>ðŸ’° Monthly Spending Tracker</h2>

<!-- AUTH -->
<div id="authSection" class="card">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appSection" style="display:none">

<div class="card">
<label><b>Select Month</b></label>
<input type="month" id="monthPicker">
</div>

<!-- SUMMARY -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Summary âŒ„</h3>
<div class="content" style="display:block;">
<div class="green">Income â‚¹<span id="income">0</span></div>
<div class="red">Expense â‚¹<span id="expense">0</span></div>
<b>Remaining â‚¹<span id="remaining">0</span></b>
<div id="categorySummary"></div>
</div>
</div>

<!-- SALARY -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Salary âŒ„</h3>
<div class="content">
<input id="salaryName" placeholder="Source">
<input id="salaryAmount" type="number" placeholder="Amount">
<button onclick="addSalary()">Save</button>
<div id="salaryList"></div>
</div>
</div>

<!-- INWARD CASH -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Inward Cash âŒ„</h3>
<div class="content">
<input id="inwardName" placeholder="Source">
<input id="inwardAmount" type="number" placeholder="Amount">
<button onclick="addInward()">Save</button>
<div id="inwardList"></div>
</div>
</div>

<!-- CATEGORIES -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Categories âŒ„</h3>
<div class="content">
<input id="categoryName" placeholder="Category">
<button onclick="addCategory()">Save</button>
<select id="categorySelect"></select>
<div id="categoryList"></div>
</div>
</div>

<!-- ADD EXPENSE -->
<div class="card">
<h3>Add Expense</h3>
<input id="desc" placeholder="Description">
<input id="amt" type="number" placeholder="Amount">
<select id="categorySelectExpense"></select>
<button onclick="addExpense()">Add Expense</button>
</div>

<!-- EXPENSE LIST -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Expenses âŒ„</h3>
<div class="content" style="display:block;">
<div id="expenseList"></div>
</div>
</div>

</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {getDatabase,ref,push,get,remove,child} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import {getAuth,signInWithEmailAndPassword,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* FIREBASE */
const firebaseConfig={
 apiKey:"AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
 authDomain:"striped-acrobat-342207.firebaseapp.com",
 databaseURL:"https://striped-acrobat-342207-default-rtdb.firebaseio.com",
 projectId:"striped-acrobat-342207"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const auth=getAuth(app);

/* DELETE PASSWORD */
const DELETE_PASSWORD = "Confirm";
const confirmDelete = () => prompt("Enter delete password") === DELETE_PASSWORD;

/* HELPERS */
const month=()=>monthPicker.value;
const mRef=p=>ref(db,"spending/months/"+month()+"/"+p);
const catRef=ref(db,"spending/categories");

/* UI COLLAPSE */
window.toggle=h=>{
 const c=h.nextElementSibling;
 c.style.display=c.style.display==="block"?"none":"block";
};

/* AUTH */
window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value);
onAuthStateChanged(auth,u=>{
 if(u){
  authSection.style.display="none";
  appSection.style.display="block";
  monthPicker.value=new Date().toISOString().slice(0,7);
  loadAll();
 }
});
monthPicker.onchange=loadAll;

/* LOAD ALL */
async function loadAll(){
 await loadCategories();
 await loadSalary();
 await loadInward();
 await loadExpenses();
}

/* SALARY */
window.addSalary=async()=>{
 if(!salaryName.value || !salaryAmount.value) return;
 await push(mRef("salary"),{
  name:salaryName.value,
  amount:+salaryAmount.value,
  date:Date.now()
 });
 salaryName.value=salaryAmount.value="";
 loadSalary();
};
async function loadSalary(){
 const s=await get(mRef("salary"));
 salaryList.innerHTML="";
 let total=0;
 if(s.exists()){
   s.forEach(c=>{
     const v=c.val();
     total+=v.amount;
     salaryList.innerHTML += `${v.name}: â‚¹${v.amount} <button class="danger" onclick="deleteItem('salary','${c.key}')">Delete</button><br>`;
   });
 }
 income.innerText=total;calcRemaining();
}

/* INWARD */
window.addInward=async()=>{
 if(!inwardName.value || !inwardAmount.value) return;
 await push(mRef("inward"),{
  name:inwardName.value,
  amount:+inwardAmount.value,
  date:Date.now()
 });
 inwardName.value=inwardAmount.value="";
 loadInward();
};
async function loadInward(){
 const s=await get(mRef("inward"));
 inwardList.innerHTML="";
 if(s.exists()){
   s.forEach(c=>{
     const v=c.val();
     inwardList.innerHTML += `${v.name}: â‚¹${v.amount} <button class="danger" onclick="deleteItem('inward','${c.key}')">Delete</button><br>`;
   });
 }
}

/* CATEGORY */
window.addCategory=async()=>{
 if(!categoryName.value) return;
 await push(catRef,{name:categoryName.value});
 categoryName.value="";
 loadCategories();
};
async function loadCategories(){
 const s=await get(catRef);
 categorySelect.innerHTML="";
 categorySelectExpense.innerHTML="";
 categoryList.innerHTML="";
 if(s.exists()){
   s.forEach(c=>{
     const name=c.val().name;
     categorySelect.innerHTML += `<option>${name}</option>`;
     categorySelectExpense.innerHTML += `<option>${name}</option>`;
     categoryList.innerHTML += `${name} <button class="danger" onclick="deleteCategory('${c.key}')">Delete</button><br>`;
   });
 }
}

/* DELETE CATEGORY */
window.deleteCategory=async(id)=>{
 if(!confirmDelete()) return;
 await remove(child(catRef,id));
 loadCategories();
}

/* EXPENSE */
window.addExpense=async()=>{
 if(!desc.value || !amt.value || !categorySelectExpense.value) return alert("Fill all fields");
 if(!confirm("Confirm add this expense?")) return;
 await push(mRef("expenses"),{
  desc:desc.value,
  amount:+amt.value,
  category:categorySelectExpense.value,
  date:Date.now()
 });
 desc.value=amt.value="";
 loadExpenses();
};

/* LOAD EXPENSES */
async function loadExpenses(){
 const s=await get(mRef("expenses"));
 expenseList.innerHTML="";
 let total=0, summary={};
 if(s.exists()){
   s.forEach(c=>{
     const v=c.val();
     total+=v.amount;
     summary[v.category]=(summary[v.category]||0)+v.amount;
     expenseList.innerHTML += `
       <div>
         ${v.desc} - â‚¹${v.amount} (${v.category})
         <div class="small">${new Date(v.date).toLocaleString()}</div>
         <button class="danger" onclick="deleteItem('expenses','${c.key}')">Delete</button>
         <hr>
       </div>`;
   });
 }
 expense.innerText=total;

 categorySummary.innerHTML="";
 for(let k in summary){
   const perc = total ? ((summary[k]/total)*100).toFixed(1) : 0;
   categorySummary.innerHTML += `${k}: â‚¹${summary[k]} (${perc}%)<br>`;
 }
 calcRemaining();
}

/* DELETE INDIVIDUAL ITEM */
window.deleteItem=async(type,id)=>{
 if(!confirmDelete()) return;
 if(confirm("Delete this item?")){
   if(type==='salary') await remove(child(mRef("salary"),id));
   if(type==='inward') await remove(child(mRef("inward"),id));
   if(type==='expenses') await remove(child(mRef("expenses"),id));
   loadAll();
 }
}

/* REMAINING */
function calcRemaining(){
 remaining.innerText=(+income.innerText||0)-(+expense.innerText||0);
}
</script>
</body>
</html>
