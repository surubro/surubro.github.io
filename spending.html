<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monthly Spending Tracker</title>
<style>
body{font-family:Arial;background:#f3f4f6;margin:0}
.container{max-width:650px;margin:auto;padding:15px}
.card{background:#fff;padding:15px;margin:10px 0;border-radius:10px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{background:#4f46e5;color:#fff;border:none}
button.danger{background:#dc2626}
.green{color:#16a34a;font-weight:bold}
.red{color:#dc2626;font-weight:bold}
h2{text-align:center}
.small{font-size:12px;color:#6b7280}
.collapsible h3{margin:0;cursor:pointer;display:flex;justify-content:space-between}
.content{display:none;margin-top:10px}
</style>
</head>
<body>
<div class="container">

<h2>ðŸ’° Monthly Spending Tracker</h2>

<!-- AUTH -->
<div id="authSection" class="card">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appSection" style="display:none">

<div class="card">
<label><b>Select Month</b></label>
<input type="month" id="monthPicker">
</div>

<!-- SUMMARY (OPEN BY DEFAULT) -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Summary âŒ„</h3>
<div class="content" style="display:block;">
<div class="green">Income â‚¹<span id="income">0</span></div>
<div class="red">Expense â‚¹<span id="expense">0</span></div>
<b>Remaining â‚¹<span id="remaining">0</span></b>
<div id="categorySummary"></div>
</div>
</div>

<!-- SALARY -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Salary âŒ„</h3>
<div class="content">
<input id="salaryName" placeholder="Source">
<input id="salaryAmount" type="number" placeholder="Amount">
<button onclick="addSalary()">Save</button>
<div id="salaryList"></div>
<button class="danger" onclick="deleteAll('salary')">Delete All Salary</button>
</div>
</div>

<!-- INWARD CASH -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Inward Cash âŒ„</h3>
<div class="content">
<input id="inwardName" placeholder="Source">
<input id="inwardAmount" type="number" placeholder="Amount">
<button onclick="addInward()">Save</button>
<div id="inwardList"></div>
<button class="danger" onclick="deleteAll('inward')">Delete All Inward Cash</button>
</div>
</div>

<!-- CATEGORIES -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Categories âŒ„</h3>
<div class="content">
<input id="categoryName" placeholder="Category">
<button onclick="addCategory()">Save</button>
<select id="categorySelect"></select>
<button class="danger" onclick="deleteAll('categories')">Delete All Categories</button>
</div>
</div>

<!-- ADD EXPENSE (ALWAYS OPEN) -->
<div class="card">
<h3>Add Expense</h3>
<input id="desc" placeholder="Description">
<input id="amt" type="number" placeholder="Amount">
<select id="categorySelectExpense"></select>
<button onclick="addExpense()">Add Expense</button>
</div>

<!-- EXPENSE LIST (OPEN BY DEFAULT) -->
<div class="card collapsible">
<h3 onclick="toggle(this)">Expenses âŒ„</h3>
<div class="content" style="display:block;">
<div id="expenseList"></div>
<button class="danger" onclick="deleteAll('expenses')">Delete All Expenses</button>
</div>
</div>

</div>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {getDatabase,ref,push,get,remove} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import {getAuth,signInWithEmailAndPassword,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* FIREBASE */
const firebaseConfig={
 apiKey:"AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
 authDomain:"striped-acrobat-342207.firebaseapp.com",
 databaseURL:"https://striped-acrobat-342207-default-rtdb.firebaseio.com",
 projectId:"striped-acrobat-342207"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const auth=getAuth(app);

/* DELETE PROTECTION */
const DELETE_PASSWORD = "Confirm";
const confirmDelete = () => prompt("Enter delete password") === DELETE_PASSWORD;

/* HELPERS */
const month=()=>monthPicker.value;
const mRef=p=>ref(db,"spending/months/"+month()+"/"+p);
const catRef=ref(db,"spending/categories");

/* UI */
window.toggle=h=>{
 const c=h.nextElementSibling;
 c.style.display=c.style.display==="block"?"none":"block";
};

/* AUTH */
window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value);
onAuthStateChanged(auth,u=>{
 if(u){
  authSection.style.display="none";
  appSection.style.display="block";
  monthPicker.value=new Date().toISOString().slice(0,7);
  loadAll();
 }
});
monthPicker.onchange=loadAll;

/* LOAD ALL */
async function loadAll(){
 await loadSalary();
 await loadInward();
 await loadCategories();
 await loadExpenses();
}

/* SALARY */
window.addSalary=async()=>{
 await push(mRef("salary"),{
  name:salaryName.value,
  amount:+salaryAmount.value,
  date:Date.now()
 });
 salaryName.value=salaryAmount.value="";
 loadSalary();
};
async function loadSalary(){
 const s=await get(mRef("salary"));
 let arr=[],total=0;
 s.forEach(c=>arr.push(c.val()));
 arr.sort((a,b)=>a.date-b.date);
 salaryList.innerHTML="";
 arr.forEach(v=>{total+=v.amount;salaryList.innerHTML+=`${v.name}: â‚¹${v.amount}<br>`});
 income.innerText=total;calcRemaining();
}

/* INWARD */
window.addInward=async()=>{
 await push(mRef("inward"),{
  name:inwardName.value,
  amount:+inwardAmount.value,
  date:Date.now()
 });
 inwardName.value=inwardAmount.value="";
 loadInward();
};
async function loadInward(){
 const s=await get(mRef("inward"));
 inwardList.innerHTML="";
 s.forEach(c=>inwardList.innerHTML+=`${c.val().name}: â‚¹${c.val().amount}<br>`);
}

/* CATEGORY */
window.addCategory=async()=>{
 await push(catRef,{name:categoryName.value});
 categoryName.value="";
 loadCategories();
};
async function loadCategories(){
 const s=await get(catRef);
 categorySelect.innerHTML="";
 categorySelectExpense.innerHTML="";
 s.forEach(c=>{
   const name=c.val().name;
   categorySelect.innerHTML+=`<option>${name}</option>`;
   categorySelectExpense.innerHTML+=`<option>${name}</option>`;
 });
}

/* EXPENSE */
window.addExpense=async()=>{
 if(!confirm("Confirm add this expense?")) return;
 await push(mRef("expenses"),{
  desc:desc.value,
  amount:+amt.value,
  category:categorySelectExpense.value,
  date:Date.now()
 });
 desc.value=amt.value="";
 loadExpenses();
};

/* LOAD EXPENSES */
async function loadExpenses(){
 const s=await get(mRef("expenses"));
 let arr=[], total=0, summary={};
 s.forEach(c=>arr.push({id:c.key,...c.val()}));
 arr.sort((a,b)=>a.date-b.date);

 expenseList.innerHTML="";
 arr.forEach(v=>{
  total+=v.amount;
  summary[v.category]=(summary[v.category]||0)+v.amount;

  expenseList.innerHTML+=`
   <div>
    ${v.desc} - â‚¹${v.amount} (${v.category})
    <div class="small">${new Date(v.date).toLocaleString()}</div>
    <button class="danger" onclick="deleteExpense('${v.id}')">Delete</button>
    <hr>
   </div>`;
 });
 expense.innerText=total;

 categorySummary.innerHTML="";
 for(let k in summary)
  categorySummary.innerHTML+=`${k}: â‚¹${summary[k]}<br>`;
 calcRemaining();
}

/* DELETE SINGLE EXPENSE */
window.deleteExpense=async(id)=>{
 if(!confirmDelete()) return;
 if(confirm("Delete this expense?")){
  await remove(mRef("expenses/"+id));
  loadExpenses();
 }
};

/* DELETE ANY CATEGORY OF DATA */
window.deleteAll=async(type)=>{
 if(!confirmDelete()) return;
 if(confirm(`Delete ALL ${type}?`)){
  await remove(mRef(type==='categories'?'categories':type));
  if(type==='categories') loadCategories();
  if(type==='salary') loadSalary();
  if(type==='inward') loadInward();
  if(type==='expenses') loadExpenses();
 }
};

/* REMAINING */
function calcRemaining(){
 remaining.innerText=(+income.innerText||0)-(+expense.innerText||0);
}
</script>
</body>
</html>
