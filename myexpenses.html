<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>credit card Expenses Manager</title>

<style>
body { font-family: Arial; margin:0; padding:0; background:#f9fafb; }
.container { max-width:500px; margin:auto; padding:20px; }
h2 { text-align:center; }
.card { background:white; padding:12px; margin-bottom:10px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
input,select,button { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ccc; }
button { background:#4f46e5; color:white; border:none; cursor:pointer; }
button:hover { background:#4338ca; }
.delete { background:#dc2626; }
.delete:hover { background:#b91c1c; }
summary { font-weight:bold; cursor:pointer; }
.summary { background:#eef2ff; padding:10px; border-radius:10px; margin-bottom:15px; }
.smallbtn { padding:4px 8px; width:auto; margin-top:5px; }
</style>

</head>
<body>

<div class="container">
<h2>ðŸ’° credit Expenses Manager</h2>

<div id="authSection">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
</div>

<div id="appSection" style="display:none;">

<div class="summary">
<strong>Total Spending:</strong> â‚¹<span id="totalExpenses">0</span><br>
<strong>Total Remaining:</strong> â‚¹<span id="totalRemaining">0</span>
</div>

<!-- INCOME COLLAPSED DEFAULT -->

<div class="card">
<details>
<summary>Income</summary>

<input type="text" id="incomeDesc" placeholder="Income Name">
<input type="number" id="incomeAmount" placeholder="Amount">
<button onclick="addIncome()">Add Income</button>

<div id="incomeList"></div>
</details>
</div>

<div class="card">
<h3>Add Category</h3>
<input type="text" id="categoryInput" placeholder="Category Name">
<button onclick="addCategory()">Add Category</button>
<div id="categoryList"></div>
</div>

<div class="card">
<h3>Add Expense</h3>
<input type="text" id="descInput" placeholder="Description">
<input type="number" id="amountInput" placeholder="Amount">
<select id="categorySelect"></select>
<select id="incomeSelect"></select>
<button onclick="addExpense()">Add Expense</button>
</div>

<div class="card">
<h3>Expenses</h3>
<div id="expenseList"></div>
<button class="delete" onclick="deleteAllExpenses()">Delete All Expenses</button>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update, get, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* YOUR FIREBASE CONFIG */
const firebaseConfig = {
apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
authDomain: "striped-acrobat-342207.firebaseapp.com",
databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
projectId: "striped-acrobat-342207"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const incomesRef = ref(db,"expenses/incomes");
const expensesRef = ref(db,"expenses/items");
const categoriesRef = ref(db,"expenses/categories");

const PASSWORD = "Confirm";
function askPassword(){ return prompt("Enter password:")===PASSWORD; }

/* LOGIN */
window.login=()=> {
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>alert(e.message));
};
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
authSection.style.display="none";
appSection.style.display="block";
loadData();
}else{
authSection.style.display="block";
appSection.style.display="none";
}
});

/* ADD INCOME */
window.addIncome=()=>{
let desc=incomeDesc.value.trim();
let amount=parseFloat(incomeAmount.value);
if(!desc||!amount)return;

push(incomesRef,{desc,amount,remaining:amount});
incomeDesc.value="";incomeAmount.value="";
};

/* EDIT INCOME */
window.editIncome=async(id)=>{
let val=prompt("New amount:");
if(!val)return;
await update(ref(db,"expenses/incomes/"+id),{amount:parseFloat(val),remaining:parseFloat(val)});
};

/* DELETE INCOME */
window.deleteIncome=async(id)=>{
if(!confirm("Delete income?"))return;
await remove(ref(db,"expenses/incomes/"+id));
};

/* ADD CATEGORY */
window.addCategory=()=>{
let name=categoryInput.value.trim();
if(!name)return;
push(categoriesRef,{name});
categoryInput.value="";
};

/* EDIT CATEGORY */
window.editCategory=async(id,name)=>{
let val=prompt("Edit category:",name);
if(!val)return;
await update(ref(db,"expenses/categories/"+id),{name:val});
};

/* DELETE CATEGORY */
window.deleteCategory=async(id)=>{
if(!confirm("Delete category?"))return;
await remove(ref(db,"expenses/categories/"+id));
};

/* ADD EXPENSE */
window.addExpense=async()=>{
let desc=descInput.value.trim();
let amount=parseFloat(amountInput.value);
let category=categorySelect.value;
let incomeId=incomeSelect.value;
if(!desc||!amount)return;

let snap=await get(ref(db,"expenses/incomes/"+incomeId));
let income=snap.val();
if(income.remaining<amount)return alert("Not enough balance");

let newRef=push(expensesRef);
let updates={};
updates[`expenses/incomes/${incomeId}/remaining`]=income.remaining-amount;
updates[`expenses/items/${newRef.key}`]={
desc,amount,category,incomeId,incomeName:income.desc,date:Date.now()
};
await update(ref(db),updates);

descInput.value="";amountInput.value="";
};

/* DELETE SINGLE EXPENSE */
window.deleteExpense=async(id,incomeId,amount)=>{
if(!askPassword())return;
if(!confirm("Delete this expense?"))return;

let snap=await get(ref(db,"expenses/incomes/"+incomeId));
let rem=snap.val().remaining;

let updates={};
updates[`expenses/incomes/${incomeId}/remaining`]=rem+amount;
updates[`expenses/items/${id}`]=null;
await update(ref(db),updates);
};

/* DELETE ALL */
window.deleteAllExpenses=async()=>{
if(!askPassword())return;
if(!confirm("Delete ALL expenses?"))return;

let snap=await get(incomesRef);
let updates={};
snap.forEach(c=>{
updates[`expenses/incomes/${c.key}/remaining`]=c.val().amount;
});
updates["expenses/items"]=null;
await update(ref(db),updates);
};

/* LOAD DATA */
function loadData(){

onValue(incomesRef,snap=>{
incomeList.innerHTML="";
incomeSelect.innerHTML="";
let totalRem=0;

snap.forEach(c=>{
let i=c.val();
totalRem+=i.remaining;

incomeSelect.innerHTML+=`<option value="${c.key}">${i.desc}</option>`;
incomeList.innerHTML+=`
<div class="card">
<strong>${i.desc}</strong><br>
Total: â‚¹${i.amount}<br>
Remaining: â‚¹${i.remaining}<br>
<button class="smallbtn" onclick="editIncome('${c.key}')">Edit</button>
<button class="delete smallbtn" onclick="deleteIncome('${c.key}')">Delete</button>
</div>`;
});

totalRemaining.innerText=totalRem;
});

onValue(categoriesRef,snap=>{
categorySelect.innerHTML="";
categoryList.innerHTML="";
snap.forEach(c=>{
categorySelect.innerHTML+=`<option>${c.val().name}</option>`;
categoryList.innerHTML+=`
<div>
${c.val().name}
<button class="smallbtn" onclick="editCategory('${c.key}','${c.val().name}')">Edit</button>
<button class="delete smallbtn" onclick="deleteCategory('${c.key}')">Delete</button>
</div>`;
});
});

onValue(expensesRef,snap=>{
expenseList.innerHTML="";
let total=0;
snap.forEach(c=>{
let e=c.val();
total+=e.amount;
expenseList.innerHTML+=`
<div class="card">
<strong>${e.desc}</strong> - â‚¹${e.amount} (${e.category})<br>
<button class="delete smallbtn" onclick="deleteExpense('${c.key}','${e.incomeId}',${e.amount})">Delete</button>
</div>`;
});
totalExpenses.innerText=total;
});
}
</script>

</body>
</html>
