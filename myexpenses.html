<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expenses Manager</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; margin:0; padding:20px; }
    .container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    h2 { text-align:center; margin-bottom:20px; }
    input, button { padding:10px; margin:5px 0; border-radius:8px; border:1px solid #ccc; width:100%; }
    button { cursor:pointer; background:#4CAF50; color:white; border:none; }
    button:hover { opacity:0.9; }
    .card { background:#fafafa; padding:12px; margin:8px 0; border-radius:10px; display:flex; justify-content:space-between; align-items:center; }
    .actions button { margin-left:5px; background:#007BFF; }
    .actions .delete { background:#dc3545; }
    .summary { background:#eef; padding:12px; border-radius:10px; margin:12px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ’° Expenses Manager</h2>

    <!-- Salary Section -->
    <div class="summary">
      <div><strong>Salary:</strong> â‚¹<span id="salaryValue">0</span></div>
      <button id="setSalaryBtn">Set / Edit Salary</button>
    </div>

    <!-- Add Expense -->
    <input type="text" id="expenseDesc" placeholder="Expense Description">
    <input type="number" id="expenseAmount" placeholder="Expense Amount">
    <button id="addExpense">âž• Add Expense</button>

    <!-- Summary -->
    <div class="summary">
      <div><strong>Total Expenses:</strong> â‚¹<span id="totalExpenses">0</span></div>
      <div><strong>Remaining:</strong> â‚¹<span id="remaining">0</span></div>
    </div>

    <!-- Expense List -->
    <div id="expenseList"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
      authDomain: "striped-acrobat-342207.firebaseapp.com",
      databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
      projectId: "striped-acrobat-342207",
      storageBucket: "striped-acrobat-342207.appspot.com",
      messagingSenderId: "367114842706",
      appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    const salaryRef = ref(db, "expenses/salary");
    const expensesRef = ref(db, "expenses/items");

    let salary = 0;

    // âœ… Set/Edit Salary
    document.getElementById("setSalaryBtn").addEventListener("click", () => {
      let newSalary = parseFloat(prompt("Enter your salary:", salary));
      if (!isNaN(newSalary)) {
        set(salaryRef, newSalary);
      }
    });

    // âœ… Add Expense
    document.getElementById("addExpense").addEventListener("click", () => {
      let desc = document.getElementById("expenseDesc").value.trim();
      let amount = parseFloat(document.getElementById("expenseAmount").value);
      if (desc && !isNaN(amount)) {
        push(expensesRef, { desc, amount });
        document.getElementById("expenseDesc").value = "";
        document.getElementById("expenseAmount").value = "";
      }
    });

    // âœ… Load Salary
    onValue(salaryRef, (snap) => {
      if (snap.exists()) {
        salary = snap.val();
        document.getElementById("salaryValue").innerText = salary;
        updateSummary();
      }
    });

    // âœ… Load Expenses
    onValue(expensesRef, (snap) => {
      let listDiv = document.getElementById("expenseList");
      listDiv.innerHTML = "";
      let total = 0;

      if (snap.exists()) {
        snap.forEach(child => {
          let id = child.key;
          let item = child.val();
          total += Number(item.amount);

          let div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <div><strong>${item.desc}</strong> - â‚¹${item.amount}</div>
            <div class="actions">
              <button class="edit" data-id="${id}" data-desc="${item.desc}" data-amount="${item.amount}">Edit</button>
              <button class="delete" data-id="${id}">Delete</button>
            </div>
          `;
          listDiv.prepend(div);
        });

        document.querySelectorAll(".edit").forEach(btn => {
          btn.addEventListener("click", () => {
            let id = btn.getAttribute("data-id");
            let oldDesc = btn.getAttribute("data-desc");
            let oldAmount = parseFloat(btn.getAttribute("data-amount"));
            let newDesc = prompt("Edit description:", oldDesc);
            let newAmount = parseFloat(prompt("Edit amount:", oldAmount));
            if (newDesc && !isNaN(newAmount)) {
              update(ref(db, "expenses/items/" + id), { desc: newDesc, amount: newAmount });
            }
          });
        });

        document.querySelectorAll(".delete").forEach(btn => {
          btn.addEventListener("click", () => {
            let id = btn.getAttribute("data-id");
            if (confirm("Delete this expense?")) {
              remove(ref(db, "expenses/items/" + id));
            }
          });
        });
      }

      document.getElementById("totalExpenses").innerText = total;
      updateSummary(total);
    });

    function updateSummary(total=0) {
      document.getElementById("remaining").innerText = salary - total;
    }

    // âœ… Require login + email verification
    onAuthStateChanged(auth, (user) => {
      if (!user || !user.emailVerified) {
        alert("Please sign in with a verified account to use Expenses Manager.");
      }
    });
  </script>
</body>
</html>
