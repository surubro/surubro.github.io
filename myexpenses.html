<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Expenses Manager</title>

<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9fafb; }
.container { max-width:500px; margin:auto; padding:20px; }
h2 { text-align:center; }
.card { background:white; padding:12px; margin-bottom:10px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
input,select,button { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ccc; }
button { background:#4f46e5; color:white; border:none; cursor:pointer; }
button:hover { background:#4338ca; }
.delete { background:#dc2626; }
.delete:hover { background:#b91c1c; }
.summary { background:#eef2ff; padding:10px; border-radius:10px; margin-bottom:15px; }
</style>

</head>
<body>

<div class="container">
<h2>ðŸ’° Expenses Manager</h2>

<div id="authSection">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
</div>

<div id="appSection" style="display:none;">

<div class="summary">
<strong>Total Spending:</strong> â‚¹<span id="totalExpenses">0</span><br>
<strong>Total Remaining:</strong> â‚¹<span id="totalRemaining">0</span>
</div>

<h3>Add Income</h3>
<input type="text" id="incomeDesc" placeholder="Income Name">
<input type="number" id="incomeAmount" placeholder="Amount">
<button onclick="addIncome()">Add Income</button>

<h3>Add Category</h3>
<input type="text" id="categoryInput" placeholder="Category Name">
<button onclick="addCategory()">Add Category</button>

<h3>Add Expense</h3>
<input type="text" id="descInput" placeholder="Description">
<input type="number" id="amountInput" placeholder="Amount">
<select id="categorySelect"></select>
<select id="incomeSelect"></select>
<button onclick="addExpense()">Add Expense</button>

<button class="delete" onclick="deleteAllExpenses()">Delete All Expenses</button>

<h3>Incomes</h3>
<div id="incomeList"></div>

<h3>Expenses</h3>
<div id="expenseList"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* YOUR REAL FIREBASE CONFIG */
const firebaseConfig = {
apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
authDomain: "striped-acrobat-342207.firebaseapp.com",
databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
projectId: "striped-acrobat-342207"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const incomesRef = ref(db,"expenses/incomes");
const expensesRef = ref(db,"expenses/items");
const categoriesRef = ref(db,"expenses/categories");

const PASSWORD = "Confirm";

function askPassword(){
return prompt("Enter password:") === PASSWORD;
}

/* LOGIN */
window.login = function(){
signInWithEmailAndPassword(auth,email.value,password.value)
.then(()=>alert("Login successful"))
.catch(err=>alert(err.message));
};

window.logout = function(){
signOut(auth);
};

onAuthStateChanged(auth,user=>{
if(user){
authSection.style.display="none";
appSection.style.display="block";
loadData();
}else{
authSection.style.display="block";
appSection.style.display="none";
}
});

/* ADD INCOME */
window.addIncome = async ()=>{
const desc = incomeDesc.value.trim();
const amount = parseFloat(incomeAmount.value);
if(!desc || isNaN(amount)) return;

const newRef = push(incomesRef);
await update(ref(db),{
[`expenses/incomes/${newRef.key}`]:{
desc,amount,remaining:amount
}
});

incomeDesc.value="";
incomeAmount.value="";
};

/* ADD CATEGORY */
window.addCategory = ()=>{
const name = categoryInput.value.trim();
if(!name) return;
push(categoriesRef,{name});
categoryInput.value="";
};

/* ADD EXPENSE */
window.addExpense = async ()=>{
const desc = descInput.value.trim();
const amount = parseFloat(amountInput.value);
const category = categorySelect.value;
const incomeId = incomeSelect.value;
if(!desc || isNaN(amount)) return;

const incSnap = await get(ref(db,"expenses/incomes/"+incomeId));
const income = incSnap.val();
if(income.remaining < amount) return alert("Not enough balance");

const newRef = push(expensesRef);

const updates={};
updates[`expenses/incomes/${incomeId}/remaining`] = income.remaining - amount;
updates[`expenses/items/${newRef.key}`] = {
desc,amount,category,incomeName:income.desc,incomeId,date:Date.now()
};

await update(ref(db),updates);

descInput.value="";
amountInput.value="";
};

/* DELETE SINGLE */
window.deleteExpense = async (id,incomeId,amount)=>{
if(!askPassword()) return;

const incSnap = await get(ref(db,"expenses/incomes/"+incomeId));
const rem = incSnap.val().remaining;

const updates={};
updates[`expenses/incomes/${incomeId}/remaining`] = rem + amount;
updates[`expenses/items/${id}`] = null;

await update(ref(db),updates);
};

/* DELETE ALL */
window.deleteAllExpenses = async ()=>{
if(!askPassword()) return;
if(!confirm("Delete ALL expenses?")) return;

const incSnap = await get(incomesRef);
const updates={};

incSnap.forEach(c=>{
updates[`expenses/incomes/${c.key}/remaining`] = c.val().amount;
});

updates["expenses/items"] = null;

await update(ref(db),updates);
alert("All expenses deleted");
};

/* LOAD DATA */
function loadData(){

onValue(incomesRef,snap=>{
incomeList.innerHTML="";
incomeSelect.innerHTML="";
let totalRemaining=0;

snap.forEach(c=>{
const i=c.val();
totalRemaining += i.remaining;

incomeSelect.innerHTML += `<option value="${c.key}">${i.desc}</option>`;
incomeList.innerHTML += `
<div class="card">
<strong>${i.desc}</strong><br>
Total: â‚¹${i.amount}<br>
Remaining: â‚¹${i.remaining}
</div>`;
});

document.getElementById("totalRemaining").innerText = totalRemaining;
});

onValue(categoriesRef,snap=>{
categorySelect.innerHTML="";
snap.forEach(c=>{
categorySelect.innerHTML += `<option>${c.val().name}</option>`;
});
});

onValue(expensesRef,snap=>{
expenseList.innerHTML="";
let total=0;

snap.forEach(c=>{
const e=c.val();
total += e.amount;

expenseList.innerHTML += `
<div class="card">
<strong>${e.desc}</strong> - â‚¹${e.amount} (${e.category})
<button class="delete" onclick="deleteExpense('${c.key}','${e.incomeId}',${e.amount})">Delete</button>
</div>`;
});

document.getElementById("totalExpenses").innerText = total;
});
}
</script>

</body>
</html>
