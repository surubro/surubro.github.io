<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Expenses Manager</title>

<style>
body { font-family: Arial; margin:0; padding:0; background:#f9fafb; }
.container { max-width:500px; margin:auto; padding:20px; }
h2,h3 { text-align:center; }
.card { background:white; padding:12px; margin-bottom:10px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
input,select,button { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ccc; }
button { background:#4f46e5; color:white; border:none; }
button:hover { background:#4338ca; }
.delete { background:#dc2626; }
.delete:hover { background:#b91c1c; }
.summary { background:#e0f2fe; padding:10px; border-radius:8px; margin-bottom:10px; }
</style>

</head>
<body>

<div class="container">
<h2>ðŸ’° Expenses Manager</h2>

<div id="authSection">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
</div>

<div id="appSection" style="display:none;">

<!-- SUMMARY -->

<div class="summary">
<strong>Total Spending:</strong> â‚¹<span id="totalSpend">0</span><br>
<strong>Total Remaining:</strong> â‚¹<span id="totalRemain">0</span>
</div>

<!-- ADD INCOME -->

<h3>Add Income</h3>
<input type="text" id="incomeDesc" placeholder="Income Name (Bank/Cash)">
<input type="number" id="incomeAmount" placeholder="Income Amount">
<button onclick="addIncome()">Add Income</button>

<!-- ADD CATEGORY -->

<h3>Add Category</h3>
<input type="text" id="categoryInput" placeholder="Category Name">
<button onclick="addCategory()">Add Category</button>

<!-- ADD EXPENSE -->

<h3>Add Expense</h3>
<input type="text" id="descInput" placeholder="Expense Description">
<input type="number" id="amountInput" placeholder="Expense Amount">
<select id="categorySelect"></select>
<select id="incomeSelect"></select>
<button onclick="addExpense()">Add Expense</button>

<button class="delete" onclick="deleteAllExpenses()">Delete All Expenses</button>

<h3>Incomes</h3>
<div id="incomeList"></div>

<h3>Expenses</h3>
<div id="list"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
apiKey: "YOUR_API_KEY",
authDomain: "YOUR_AUTH_DOMAIN",
databaseURL: "YOUR_DATABASE_URL",
projectId: "YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const incomesRef = ref(db,"expenses/incomes");
const expensesRef = ref(db,"expenses/items");
const categoriesRef = ref(db,"expenses/categories");

const PASSWORD="Confirm";

function askPassword(){
return prompt("Enter password:")===PASSWORD;
}

window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value);
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
authSection.style.display="none";
appSection.style.display="block";
loadAll();
}else{
authSection.style.display="block";
appSection.style.display="none";
}
});

// ADD INCOME
window.addIncome=async()=>{
const desc=incomeDesc.value.trim();
const amt=parseFloat(incomeAmount.value);
if(!desc||!amt)return;

const newRef=push(incomesRef);
await update(ref(db),{
[`expenses/incomes/${newRef.key}`]:{
desc,amount:amt,remaining:amt
}
});
incomeDesc.value=""; incomeAmount.value="";
};

// ADD CATEGORY
window.addCategory=()=>{
const name=categoryInput.value.trim();
if(!name)return;
push(categoriesRef,{name});
categoryInput.value="";
};

// ADD EXPENSE
window.addExpense=async()=>{
const desc=descInput.value.trim();
const amt=parseFloat(amountInput.value);
const cat=categorySelect.value;
const incomeId=incomeSelect.value;
if(!desc||!amt)return;

const incSnap=await get(ref(db,"expenses/incomes/"+incomeId));
const inc=incSnap.val();
if(inc.remaining<amt) return alert("Not enough balance");

const newRef=push(expensesRef);

const updates={};
updates[`expenses/incomes/${incomeId}/remaining`]=inc.remaining-amt;
updates[`expenses/items/${newRef.key}`]={
desc,amount:amt,category:cat,incomeName:inc.desc,incomeId,date:Date.now()
};

await update(ref(db),updates);
};

// DELETE SINGLE
window.deleteExpense=async(id,incomeId,amt)=>{
if(!askPassword()) return;

const incSnap=await get(ref(db,"expenses/incomes/"+incomeId));
const rem=incSnap.val().remaining;

const updates={};
updates[`expenses/incomes/${incomeId}/remaining`]=rem+amt;
updates[`expenses/items/${id}`]=null;

await update(ref(db),updates);
};

// DELETE ALL
window.deleteAllExpenses=async()=>{
if(!askPassword()) return;

const incSnap=await get(incomesRef);
const updates={};

incSnap.forEach(c=>{
updates[`expenses/incomes/${c.key}/remaining`]=c.val().amount;
});

updates["expenses/items"]=null;
await update(ref(db),updates);
};

// LOAD EVERYTHING
function loadAll(){

// Incomes
onValue(incomesRef,snap=>{
incomeList.innerHTML="";
incomeSelect.innerHTML="";
let totalRemain=0;

snap.forEach(c=>{
const i=c.val();
totalRemain+=i.remaining;

incomeSelect.innerHTML+=`<option value="${c.key}">${i.desc}</option>`;
incomeList.innerHTML+=`
<div class="card">
<strong>${i.desc}</strong><br>
Amount: â‚¹${i.amount}<br>
Remaining: â‚¹${i.remaining}
</div>`;
});

totalRemainSpan= document.getElementById("totalRemain");
totalRemainSpan.textContent=totalRemain;
});

// Categories
onValue(categoriesRef,snap=>{
categorySelect.innerHTML="";
snap.forEach(c=>{
categorySelect.innerHTML+=`<option>${c.val().name}</option>`;
});
});

// Expenses
onValue(expensesRef,snap=>{
list.innerHTML="";
let total=0;

snap.forEach(c=>{
const e=c.val();
total+=e.amount;

list.innerHTML+=`
<div class="card">
<strong>${e.desc}</strong> - â‚¹${e.amount} (${e.category})
<button class="delete" onclick="deleteExpense('${c.key}','${e.incomeId}',${e.amount})">Delete</button>
</div>`;
});

document.getElementById("totalSpend").textContent=total;
});
}

</script>

</body>
</html>
