<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Group Bots ..Messages</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: Arial; max-width: 400px; margin: auto; padding: 10px; }
  h2 { margin-bottom: 10px; }
  #messages { border: 1px solid #ccc; padding: 8px; height: 300px; overflow-y: auto; background: #f9f9f9; }
  .msg { margin-bottom: 8px; padding: 6px; border-radius: 6px; background: #e6ffe6; }
  .bot { font-weight: bold; }
  .time { font-size: 11px; color: #555; }
  button { margin-top: 10px; padding: 6px 8px; cursor: pointer; }
</style>
</head>
<body>

<h2>Last Messages from Bots in Group</h2>
<div id="messages">Loading...</div>
<button id="refreshBtn">Refresh Now</button>

<script>
const BOT_TOKEN = "8444938038:AAEcK1lLbsYQsN6WiHz2La-mD0_QZBwIZss";
const GROUP_CHAT_ID = -1003095792973;
const API_BASE = "https://api.telegram.org/bot" + BOT_TOKEN;
const POLL_MS = 3000;

const messagesEl = document.getElementById('messages');
const refreshBtn = document.getElementById('refreshBtn');

let lastUpdateId = 0;

function formatTime(ts) {
  const d = new Date(ts * 1000);
  return d.toLocaleString();
}

function appendMessage(botName, text, date) {
  const div = document.createElement('div');
  div.className = "msg";
  div.innerHTML = `<span class="bot">${botName}</span>: ${text}<br><span class="time">${formatTime(date)}</span>`;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

async function fetchBotMessages() {
  try {
    const url = API_BASE + '/getUpdates?timeout=0' + (lastUpdateId ? '&offset=' + (lastUpdateId + 1) : '');
    const res = await fetch(url);
    const data = await res.json();
    if (!data.ok) return;

    const updates = data.result;
    updates.forEach(upd => {
      lastUpdateId = upd.update_id;
      const m = upd.message || upd.channel_post || upd.edited_message;
      if (!m || !m.chat) return;

      // only messages in our group
      if (Number(m.chat.id) !== Number(GROUP_CHAT_ID)) return;

      // only messages sent by bots
      if (m.from && m.from.is_bot) {
        const botName = m.from.username || m.from.first_name || "bot";
        const text = m.text || m.caption || "(no text)";
        const date = m.date || Math.floor(Date.now()/1000);
        appendMessage(botName, text, date);
      }
    });
  } catch (err) {
    console.error("Fetch error:", err);
  }
}

// polling
setInterval(fetchBotMessages, POLL_MS);
fetchBotMessages(); // initial fetch

refreshBtn.addEventListener('click', fetchBotMessages);
</script>
</body>
</html>
