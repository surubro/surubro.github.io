<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bank Manager</title>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#f4f6f8;
}
.container{
  max-width:500px;
  margin:auto;
  padding:10px;
}
.card{
  background:#fff;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
input,select,button{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button{
  border:none;
  background:#007bff;
  color:#fff;
  border-radius:6px;
}
button.danger{background:#dc3545}
button.small{width:auto;padding:4px 8px;margin-right:6px}
h3,h4{margin:6px 0}
.hidden{display:none}
.bank-title{cursor:pointer}
</style>
</head>
<body>

<div class="container">

<!-- LOGIN -->
<div id="loginCard" class="card">
  <h3>Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

  <div class="card">
    <button class="danger" onclick="logout()">Logout</button>
  </div>

  <!-- ADD BANK -->
  <div class="card">
    <h3>Add Bank</h3>
    <input id="newBank" placeholder="Bank name">
    <input id="newBalance" type="number" placeholder="Initial balance">
    <button onclick="addBank()">Add Bank</button>
  </div>

  <!-- UPDATE BALANCE -->
  <div class="card">
    <h3>Update Bank Balance</h3>
    <select id="balanceBank">
      <option value="">Select Bank</option>
    </select>
    <input id="bankBalance" type="number" placeholder="New balance">
    <button onclick="updateBalance()">Update Balance</button>
  </div>

  <!-- ADD / EDIT ENTRY -->
  <div class="card">
    <h3>Add / Edit Entry</h3>
    <select id="entryBank">
      <option value="">Select Bank</option>
    </select>
    <input id="entryName" placeholder="Entry name">
    <input id="entryAmount" type="number" placeholder="Amount">
    <button id="entryBtn" onclick="saveEntry()">Add Entry</button>
  </div>

  <!-- BANK LIST -->
  <div id="banks"></div>

  <div class="card" id="grand"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set, push, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
  authDomain: "striped-acrobat-342207.firebaseapp.com",
  databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
  projectId: "striped-acrobat-342207",
  storageBucket: "striped-acrobat-342207.appspot.com",
  messagingSenderId: "367114842706",
  appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* STATE */
let banksRef;
let editing = null;

/* AUTH */
window.login = ()=>{
  signInWithEmailAndPassword(auth,email.value,password.value)
  .catch(e=>alert(e.message));
};

window.logout = ()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  if(user){
    loginCard.classList.add("hidden");
    app.classList.remove("hidden");
    banksRef = ref(db,`bankManager/users/${user.uid}/banks`);
    loadBanks();
  }else{
    loginCard.classList.remove("hidden");
    app.classList.add("hidden");
  }
});

/* BANKS */
window.addBank = ()=>{
  const name=newBank.value.trim();
  const bal=Number(newBalance.value);
  if(!name||bal<0)return;

  set(ref(db,`bankManager/users/${auth.currentUser.uid}/banks/${name}`),{
    balance:bal
  });

  newBank.value="";
  newBalance.value="";
};

window.updateBalance = ()=>{
  if(!balanceBank.value)return;
  update(ref(db,`bankManager/users/${auth.currentUser.uid}/banks/${balanceBank.value}`),{
    balance:Number(bankBalance.value)
  });
  bankBalance.value="";
};

window.delBank = bank=>{
  if(confirm("Delete bank and all entries?")){
    remove(ref(db,`bankManager/users/${auth.currentUser.uid}/banks/${bank}`));
  }
};

/* ENTRIES */
window.saveEntry = ()=>{
  const bank=entryBank.value;
  const name=entryName.value.trim();
  const amt=Number(entryAmount.value);
  if(!bank||!name||amt<=0)return;

  if(editing){
    set(ref(db,`bankManager/users/${auth.currentUser.uid}/banks/${editing.bank}/entries/${editing.id}`),
      {name,amount:amt});
    editing=null;
    entryBtn.textContent="Add Entry";
  }else{
    push(ref(db,`bankManager/users/${auth.currentUser.uid}/banks/${bank}/entries`),
      {name,amount:amt});
  }

  entryName.value="";
  entryAmount.value="";
};

window.editEntry=(bank,id,name,amt)=>{
  entryBank.value=bank;
  entryName.value=name;
  entryAmount.value=amt;
  editing={bank,id};
  entryBtn.textContent="Update Entry";
};

window.delEntry=(bank,id)=>{
  remove(ref(db,`bankManager/users/${auth.currentUser.uid}/banks/${bank}/entries/${id}`));
};

/* UI */
window.toggle=id=>{
  const e=document.getElementById("box-"+id);
  e.style.display=e.style.display==="none"?"block":"none";
};

function loadBanks(){
  onValue(banksRef,snap=>{
    const data=snap.val()||{};
    let html="",gb=0,gu=0;

    entryBank.innerHTML="<option value=''>Select Bank</option>";
    balanceBank.innerHTML="<option value=''>Select Bank</option>";

    for(const b in data){
      entryBank.innerHTML+=`<option>${b}</option>`;
      balanceBank.innerHTML+=`<option>${b}</option>`;

      let used=0;
      html+=`
      <div class="card">
        <h4 class="bank-title" onclick="toggle('${b}')">
          ${b.toUpperCase()}
          <button class="small danger" onclick="delBank('${b}')">üóë</button>
        </h4>
        <div id="box-${b}" style="display:none">
      `;

      if(data[b].entries){
        for(const id in data[b].entries){
          const e=data[b].entries[id];
          used+=e.amount;
          html+=`
            ${e.name} ‚Çπ${e.amount}<br>
            <button class="small" onclick="editEntry('${b}','${id}','${e.name}',${e.amount})">‚úèÔ∏è</button>
            <button class="small danger" onclick="delEntry('${b}','${id}')">‚ùå</button>
            <br><br>
          `;
        }
      }

      html+=`</div>
      <p>Balance ‚Çπ${data[b].balance} | Used ‚Çπ${used} | Remaining ‚Çπ${data[b].balance-used}</p>
      </div>`;

      gb+=data[b].balance;
      gu+=used;
    }

    banks.innerHTML=html;
    grand.innerHTML=`Total ‚Çπ${gb} | Used ‚Çπ${gu} | Remaining ‚Çπ${gb-gu}`;
  });
}
</script>
</body>
</html>
