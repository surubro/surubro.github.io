<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bank Manager</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#eef2f5;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  color:#222;
}
.container{
  max-width:480px;
  margin:auto;
  padding:12px;
}
.card{
  background:#ffffff;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
  box-shadow:0 3px 10px rgba(0,0,0,.1);
}
h3,h4{margin:6px 0;color:#111}
input,select{
  width:100%;
  padding:9px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fff;
  color:#000;
}
button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border:none;
  border-radius:6px;
  background:#1976d2;
  color:#fff;
  font-size:15px;
}
button:hover{opacity:.9}
button.danger{background:#d32f2f}
button.small{
  width:auto;
  padding:4px 8px;
  font-size:13px;
  margin-right:6px;
}
.hidden{display:none}
.bank-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.entry{
  padding:6px 0;
  border-bottom:1px solid #eee;
}
.total{
  font-weight:bold;
  margin-top:6px;
}
</style>
</head>
<body>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>üîê Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- APP -->
<div id="appBox" class="hidden">

  <div class="card">
    <button class="danger" onclick="logout()">Logout</button>
  </div>

  <!-- ADD BANK -->
  <div class="card">
    <h3>üè¶ Add Bank</h3>
    <input id="bankName" placeholder="Bank name">
    <input id="bankInit" type="number" placeholder="Initial balance">
    <button onclick="addBank()">Add Bank</button>
  </div>

  <!-- UPDATE BALANCE -->
  <div class="card">
    <h3>üí∞ Update Balance</h3>
    <select id="balanceBank"></select>
    <input id="balanceValue" type="number" placeholder="New balance">
    <button onclick="updateBalance()">Update</button>
  </div>

  <!-- ENTRY -->
  <div class="card">
    <h3>‚ûï Entry</h3>
    <select id="entryBank"></select>
    <input id="entryName" placeholder="Entry name">
    <input id="entryAmount" type="number" placeholder="Amount">
    <button id="entryBtn" onclick="saveEntry()">Add Entry</button>
  </div>

  <!-- BANK LIST -->
  <div id="bankList"></div>

  <!-- TOTAL -->
  <div class="card total" id="grandTotal"></div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, set, push, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
  authDomain: "striped-acrobat-342207.firebaseapp.com",
  databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
  projectId: "striped-acrobat-342207",
  storageBucket: "striped-acrobat-342207.appspot.com",
  messagingSenderId: "367114842706",
  appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let banksRef;
let editing=null;

/* AUTH */
window.login=()=>{
  signInWithEmailAndPassword(auth,email.value,password.value)
  .catch(e=>alert(e.message));
};
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,u=>{
  if(u){
    loginBox.classList.add("hidden");
    appBox.classList.remove("hidden");
    banksRef=ref(db,`bankManager/${u.uid}`);
    load();
  }else{
    loginBox.classList.remove("hidden");
    appBox.classList.add("hidden");
  }
});

/* BANK */
window.addBank=()=>{
  if(!bankName.value)return;
  set(ref(db,`${banksRef.key}/${bankName.value}`),{
    balance:Number(bankInit.value||0)
  });
  bankName.value="";
  bankInit.value="";
};

window.updateBalance=()=>{
  update(ref(db,`${banksRef.key}/${balanceBank.value}`),{
    balance:Number(balanceValue.value)
  });
  balanceValue.value="";
};

window.delBank=b=>{
  if(confirm("Delete bank?")){
    remove(ref(db,`${banksRef.key}/${b}`));
  }
};

/* ENTRY */
window.saveEntry=()=>{
  if(!entryBank.value)return;
  const path=`${banksRef.key}/${entryBank.value}/entries`;
  if(editing){
    set(ref(db,`${path}/${editing}`),{
      name:entryName.value,
      amount:Number(entryAmount.value)
    });
    editing=null;
    entryBtn.textContent="Add Entry";
  }else{
    push(ref(db,path),{
      name:entryName.value,
      amount:Number(entryAmount.value)
    });
  }
  entryName.value="";
  entryAmount.value="";
};

window.editEntry=(b,id,n,a)=>{
  entryBank.value=b;
  entryName.value=n;
  entryAmount.value=a;
  editing=id;
  entryBtn.textContent="Update Entry";
};

window.delEntry=(b,id)=>{
  remove(ref(db,`${banksRef.key}/${b}/entries/${id}`));
};

/* LOAD */
function load(){
  onValue(banksRef,s=>{
    const d=s.val()||{};
    bankList.innerHTML="";
    entryBank.innerHTML="";
    balanceBank.innerHTML="";
    let gb=0,gu=0;

    for(const b in d){
      entryBank.innerHTML+=`<option>${b}</option>`;
      balanceBank.innerHTML+=`<option>${b}</option>`;
      let used=0;
      let entries="";
      if(d[b].entries){
        for(const id in d[b].entries){
          const e=d[b].entries[id];
          used+=e.amount;
          entries+=`
          <div class="entry">
            ${e.name} ‚Äì ‚Çπ${e.amount}<br>
            <button class="small" onclick="editEntry('${b}','${id}','${e.name}',${e.amount})">‚úè</button>
            <button class="small danger" onclick="delEntry('${b}','${id}')">‚ùå</button>
          </div>`;
        }
      }

      bankList.innerHTML+=`
      <div class="card">
        <div class="bank-header" onclick="this.nextElementSibling.classList.toggle('hidden')">
          <h4>${b}</h4>
          <button class="small danger" onclick="event.stopPropagation();delBank('${b}')">üóë</button>
        </div>
        <div class="hidden">${entries}</div>
        <div class="total">
          Balance ‚Çπ${d[b].balance} | Used ‚Çπ${used} | Remaining ‚Çπ${d[b].balance-used}
        </div>
      </div>`;
      gb+=d[b].balance;
      gu+=used;
    }
    grandTotal.textContent=`TOTAL ‚Üí Balance ‚Çπ${gb} | Used ‚Çπ${gu} | Remaining ‚Çπ${gb-gu}`;
  });
}
</script>
</body>
</html>
