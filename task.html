<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Task Manager (Auth Required)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
    body { margin: 0; font-family: Arial, sans-serif; background: #ece5dd; height: 100vh; display: flex; flex-direction: column; }
    .hidden { display: none !important; }
    #loginScreen, #chatUI { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: white; padding: 20px; }
    input { padding: 10px; font-size: 16px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; width: 220px; }
    button { padding: 8px 16px; font-size: 15px; background: #007bff; border: none; color: white; border-radius: 5px; cursor: pointer; margin-top: 5px; }
    .chat-header { background: #075e54; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
    .chat-box { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; width: 100%; }
    .message { background: #dcf8c6; padding: 8px 10px; border-radius: 7.5px; margin-bottom: 10px; max-width: 70%; align-self: flex-end; }
    .completed { background: #d3d3d3; text-decoration: line-through; color: #555; }
    .input-container { display: flex; align-items: center; padding: 8px; background: #f1f1f1; border-top: 1px solid #ccc; position: sticky; bottom: 0; width: 100%; }
    .input-container input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; outline: none; font-size: 14px; }
    .send-btn { background: #0084ff; border: none; color: white; border-radius: 50%; width: 40px; height: 40px; margin-left: 8px; font-size: 16px; cursor: pointer; }
    .clear-all { background: #dc3545; border: none; color: white; padding: 8px 12px; margin-left: 8px; border-radius: 20px; font-size: 13px; cursor: pointer; }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen">
    <h2>Login to Continue</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Sign Up</button>
    <small>Verify your email before logging in.</small>
</div>

<!-- Chat UI -->
<div id="chatUI" class="hidden">
    <div class="chat-header">
        <span>Tasks</span>
        <button id="logoutBtn">Logout</button>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Type a task...">
        <button class="send-btn" id="sendBtn"><i class="fas fa-paper-plane"></i></button>
        <button class="clear-all" id="clearBtn">Clear All</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyBxbzsSi-dsFPPGDeogz2SaEsW_3OKu-QU",
    authDomain: "striped-acrobat-342207.firebaseapp.com",
    databaseURL: "https://striped-acrobat-342207-default-rtdb.firebaseio.com",
    projectId: "striped-acrobat-342207",
    storageBucket: "striped-acrobat-342207.appspot.com",
    messagingSenderId: "367114842706",
    appId: "1:367114842706:web:0f6d504163ed3c72ed658b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const loginScreen = document.getElementById("loginScreen");
const chatUI = document.getElementById("chatUI");
const chatBox = document.getElementById("chatBox");
const messageInput = document.getElementById("messageInput");

document.getElementById("loginBtn").onclick = () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    signInWithEmailAndPassword(auth, email, password)
        .catch(err => alert(err.message));
};

document.getElementById("signupBtn").onclick = () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    createUserWithEmailAndPassword(auth, email, password)
        .then(userCredential => {
            sendEmailVerification(userCredential.user).then(() => {
                alert("Verification email sent. Please verify before logging in.");
            });
        })
        .catch(err => alert(err.message));
};

document.getElementById("logoutBtn").onclick = () => {
    signOut(auth);
};

document.getElementById("sendBtn").onclick = () => {
    if (!messageInput.value.trim()) return;
    push(ref(db, "task"), { text: messageInput.value, timestamp: Date.now(), completed: false });
    messageInput.value = "";
};

document.getElementById("clearBtn").onclick = () => {
    if (confirm("Clear all tasks?")) {
        remove(ref(db, "task"));
    }
};

function loadTasks() {
    onValue(ref(db, "task"), snapshot => {
        chatBox.innerHTML = "";
        snapshot.forEach(child => {
            const data = child.val();
            const div = document.createElement("div");
            div.className = "message" + (data.completed ? " completed" : "");
            div.textContent = data.text;
            chatBox.appendChild(div);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    });
}

onAuthStateChanged(auth, user => {
    if (user && user.emailVerified) {
        loginScreen.classList.add("hidden");
        chatUI.classList.remove("hidden");
        loadTasks();
    } else {
        chatUI.classList.add("hidden");
        loginScreen.classList.remove("hidden");
    }
});
</script>
</body>
</html>
